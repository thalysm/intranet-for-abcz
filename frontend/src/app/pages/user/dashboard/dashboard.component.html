<div class="min-h-screen bg-secondary">
  <app-navbar></app-navbar>

  <!-- Header -->
  <div class="bg-primary text-white">
    <div class="container mx-auto px-4 py-6">
      <h1 class="text-2xl font-bold">Ol√°, {{ currentUser?.name }}!</h1>
      <p class="text-blue-100">Bem-vindo ao Na Sede - ABCZ</p>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8">
    <!-- Navigation Tabs -->
    <div class="flex gap-4 mb-8 overflow-x-auto">
      <button 
        (click)="activeTab = 'news'" 
        [class.bg-primary]="activeTab === 'news'"
        [class.text-white]="activeTab === 'news'"
        [class.bg-white]="activeTab !== 'news'"
        [class.text-gray-700]="activeTab !== 'news'"
        class="px-6 py-2 rounded-lg font-medium transition-colors whitespace-nowrap">
        Feed de Not√≠cias
      </button>
      <button 
        (click)="activeTab = 'events'" 
        [class.bg-primary]="activeTab === 'events'"
        [class.text-white]="activeTab === 'events'"
        [class.bg-white]="activeTab !== 'events'"
        [class.text-gray-700]="activeTab !== 'events'"
        class="px-6 py-2 rounded-lg font-medium transition-colors whitespace-nowrap">
        Eventos
      </button>
      <button 
        (click)="activeTab = 'marketplace'" 
        [class.bg-primary]="activeTab === 'marketplace'"
        [class.text-white]="activeTab === 'marketplace'"
        [class.bg-white]="activeTab !== 'marketplace'"
        [class.text-gray-700]="activeTab !== 'marketplace'"
        class="px-6 py-2 rounded-lg font-medium transition-colors whitespace-nowrap">
        Marketplace
      </button>
      <button 
        (click)="activeTab = 'statements'" 
        [class.bg-primary]="activeTab === 'statements'"
        [class.text-white]="activeTab === 'statements'"
        [class.bg-white]="activeTab !== 'statements'"
        [class.text-gray-700]="activeTab !== 'statements'"
        class="px-6 py-2 rounded-lg font-medium transition-colors whitespace-nowrap">
        Presta√ß√£o de Contas
      </button>
    </div>

    <!-- News Feed Tab -->
    @if (activeTab === 'news') {
      <div class="max-w-3xl mx-auto space-y-6">
        @for (news of newsList; track news.id) {
          <div class="card">
            @if (news.imageUrl) {
              <img [src]="news.imageUrl" alt="{{ news.title }}" class="w-full h-64 object-cover rounded-lg mb-4">
            }
            
            <h2 class="text-2xl font-bold text-gray-900 mb-3">{{ news.title }}</h2>
            <p class="text-gray-700 mb-4 whitespace-pre-line">{{ news.content }}</p>
            
            <div class="flex items-center gap-4 text-sm text-gray-500 mb-4 pb-4 border-b border-gray-200">
              <span>{{ news.publishedAt | date: 'dd/MM/yyyy HH:mm' }}</span>
              <span>‚Ä¢</span>
              <span>Por {{ news.createdByName }}</span>
            </div>

            <!-- Comments Section -->
            <div>
              <h3 class="font-semibold text-gray-900 mb-3">
                Coment√°rios ({{ news.comments?.length || 0 }})
              </h3>

              @if (news.comments && news.comments.length > 0) {
                <div class="space-y-3 mb-4">
                  @for (comment of news.comments; track comment.id) {
                    <div class="bg-gray-50 rounded-lg p-3">
                      <div class="flex justify-between items-start mb-1">
                        <span class="font-medium text-gray-900">{{ comment.userName }}</span>
                        <span class="text-xs text-gray-500">{{ comment.createdAt | date: 'dd/MM/yyyy HH:mm' }}</span>
                      </div>
                      <p class="text-gray-700">{{ comment.content }}</p>
                    </div>
                  }
                </div>
              }

              <!-- Add Comment Form -->
              <form (submit)="addComment(news.id, commentInputs[news.id]); $event.preventDefault()" class="flex gap-2">
                <input 
                  type="text" 
                  [(ngModel)]="commentInputs[news.id]"
                  [name]="'comment-' + news.id"
                  class="input-field flex-1" 
                  placeholder="Escreva um coment√°rio...">
                <button type="submit" class="btn-primary">Comentar</button>
              </form>
            </div>
          </div>
        }

        @if (newsList.length === 0) {
          <div class="card text-center py-12">
            <p class="text-gray-500 text-lg">Nenhuma not√≠cia dispon√≠vel</p>
          </div>
        }
      </div>
    }

    <!-- Events Tab -->
    @if (activeTab === 'events') {
      <div class="max-w-4xl mx-auto">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">Pr√≥ximos Eventos</h2>
          <p class="text-gray-600">Confira os eventos da ABCZ e confirme sua presen√ßa</p>
        </div>

        <div class="space-y-4">
          @for (event of upcomingEvents; track event.id) {
            <div class="card">
              <div class="flex justify-between items-start mb-4">
                <div class="flex-1">
                  <h3 class="text-xl font-bold text-gray-900 mb-2">{{ event.title }}</h3>
                  <p class="text-gray-700 mb-3">{{ event.description }}</p>
                  
                  <div class="flex flex-wrap gap-4 text-sm text-gray-600">
                    <div class="flex items-center gap-2">
                      <span class="font-medium">Data:</span>
                      <span>{{ event.eventDate | date: 'dd/MM/yyyy HH:mm' }}</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="font-medium">Local:</span>
                      <span>{{ event.location }}</span>
                    </div>
                  </div>
                </div>

                <!-- Confirmation Status -->
                <div>
                  @if (getUserConfirmation(event) === 1) {
                    <span class="px-4 py-2 bg-green-100 text-green-700 rounded-lg font-medium">
                      Confirmado
                    </span>
                  } @else if (getUserConfirmation(event) === 2) {
                    <span class="px-4 py-2 bg-red-100 text-red-700 rounded-lg font-medium">
                      Recusado
                    </span>
                  } @else {
                    <span class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium">
                      Pendente
                    </span>
                  }
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="flex gap-3 pt-4 border-t border-gray-200">
                <button 
                  (click)="confirmEvent(event.id)"
                  [disabled]="getUserConfirmation(event) === 1"
                  class="flex-1 px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium">
                  Confirmar Presen√ßa
                </button>
                <button 
                  (click)="declineEvent(event.id)"
                  [disabled]="getUserConfirmation(event) === 2"
                  class="flex-1 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium">
                  N√£o Posso Ir
                </button>
              </div>
            </div>
          }

          @if (upcomingEvents.length === 0) {
            <div class="card text-center py-12">
              <p class="text-gray-500 text-lg">Nenhum evento pr√≥ximo</p>
            </div>
          }
        </div>
      </div>
    }

    <!-- Marketplace Tab -->
    @if (activeTab === 'marketplace') {
      <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-6">
          <div>
            <h2 class="text-2xl font-bold text-gray-900 mb-2">Marketplace</h2>
            <p class="text-gray-600">Anuncie produtos e servi√ßos ou encontre o que precisa</p>
          </div>
          <button (click)="openMarketplaceModal()" class="btn-primary">
            + Criar An√∫ncio
          </button>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          @for (item of marketplaceItems; track item.id) {
            <div class="card">
              @if (item.imageUrl) {
                <img [src]="item.imageUrl" alt="{{ item.title }}" class="w-full h-48 object-cover rounded-lg mb-4">
              } @else {
                <div class="w-full h-48 bg-gray-200 rounded-lg mb-4 flex items-center justify-center">
                  <span class="text-gray-400 text-4xl">üì¶</span>
                </div>
              }
              
              <div class="flex justify-between items-start mb-2">
                <h3 class="text-lg font-bold text-gray-900">{{ item.title }}</h3>
                <span class="px-2 py-1 bg-primary bg-opacity-10 text-primary rounded text-xs font-medium">
                  {{ item.type === 0 ? 'Produto' : 'Servi√ßo' }}
                </span>
              </div>
              
              <p class="text-gray-700 mb-2 text-sm">{{ item.description }}</p>
              <p class="text-xs text-gray-500 mb-3">Por {{ item.userName }}</p>
              
              <div class="flex justify-between items-center pt-3 border-t border-gray-200">
                <span class="text-2xl font-bold text-primary">
                  R$ {{ item.price.toFixed(2) }}
                </span>
                <div class="flex gap-2">
                  @if (isMyItem(item)) {
                    <button 
                      (click)="deleteMarketplaceItem(item.id)"
                      class="px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium">
                      Excluir
                    </button>
                  }
                  <a 
                    [href]="'https://wa.me/' + item.contactInfo.replace(/\D/g, '')" 
                    target="_blank"
                    class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm font-medium">
                    Contatar
                  </a>
                </div>
              </div>
            </div>
          }

          @if (marketplaceItems.length === 0) {
            <div class="col-span-full card text-center py-12">
              <p class="text-gray-500 text-lg mb-4">Nenhum an√∫ncio dispon√≠vel</p>
              <button (click)="openMarketplaceModal()" class="btn-primary">
                Criar Primeiro An√∫ncio
              </button>
            </div>
          }
        </div>
      </div>
    }

    <!-- Account Statements Tab -->
    @if (activeTab === 'statements') {
      <div class="max-w-4xl mx-auto">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">Presta√ß√£o de Contas</h2>
          <p class="text-gray-600">Documentos de presta√ß√£o de contas da associa√ß√£o</p>
        </div>

        <div class="space-y-4">
          @for (statement of statements; track statement.id) {
            <div class="card">
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <h3 class="text-xl font-semibold text-gray-900">{{ statement.title }}</h3>
                    @if (statement.type === 0) {
                      <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">Individual</span>
                    } @else {
                      <span class="px-3 py-1 bg-primary bg-opacity-10 text-primary rounded-full text-xs font-medium">Associa√ß√£o</span>
                    }
                  </div>
                  <p class="text-gray-600 mb-3">{{ statement.description }}</p>
                  <p class="text-sm text-gray-500">
                    Publicado em {{ statement.createdAt | date: 'dd/MM/yyyy HH:mm' }}
                  </p>
                </div>

                <button class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-600 transition-colors">
                  Visualizar
                </button>
              </div>
            </div>
          }

          @if (statements.length === 0) {
            <div class="card text-center py-12">
              <p class="text-gray-500 text-lg">Nenhum documento dispon√≠vel</p>
            </div>
          }
        </div>
      </div>
    }
  </div>

  <!-- Ouvidoria Button (Fixed) -->
  <a 
    href="https://wa.me/553891341257" 
    target="_blank"
    class="fixed bottom-6 right-6 bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600 transition-colors z-50"
    title="Ouvidoria - Entre em contato">
    <span class="text-2xl">üí¨</span>
  </a>
</div>

<!-- Marketplace Modal -->
@if (showMarketplaceModal) {
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Criar An√∫ncio</h2>

        <form [formGroup]="marketplaceForm" (ngSubmit)="onMarketplaceSubmit()">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">T√≠tulo</label>
              <input type="text" formControlName="title" class="input-field" placeholder="Ex: Vendo Zebu reprodutor">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
              <textarea formControlName="description" rows="4" class="input-field" placeholder="Descreva seu produto ou servi√ßo..."></textarea>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo (R$)</label>
                <input type="number" formControlName="price" class="input-field" placeholder="0.00" step="0.01">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                <select formControlName="type" class="input-field">
                  <option value="0">Produto</option>
                  <option value="1">Servi√ßo</option>
                </select>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">WhatsApp para contato</label>
              <input type="text" formControlName="contactInfo" class="input-field" placeholder="(38) 99134-1257">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">URL da Imagem (opcional)</label>
              <input type="text" formControlName="imageUrl" class="input-field" placeholder="https://exemplo.com/imagem.jpg">
            </div>
          </div>

          <div class="flex gap-4 mt-6">
            <button type="submit" [disabled]="marketplaceForm.invalid || isSubmitting" class="btn-primary flex-1 disabled:opacity-50">
              {{ isSubmitting ? 'Criando...' : 'Criar An√∫ncio' }}
            </button>
            <button type="button" (click)="closeMarketplaceModal()" class="btn-secondary flex-1">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
}
